
<p>
Trakkor is currently running <%= @active_trackers %> trackers,
comprising <%= Piece.count %> number of pieces.
</p>

<h3>Trackers (<%= ( @trackers || []).length %>)</h3>
<table>
  <tr>
    <th>Errors</th>
    <th>Name</th>
    <th>Id</th>
    <th>Sick</th>
    <th>#Pieces</th>
    <th>Last Err</th>
    <th>&nbsp;</th>
  </tr>
  <% for t in @trackers %>
    <tr>
    <td>  <%= t.error_count > 0 ? t.error_count : '' %> </td>
    <td> <%= link_to(t.name.truncate(50), t) %></td>
    <td><%= t.id %></td>
    <td>  <%= t.sick? ? 'sick' : '' %> </td>
    <td><%= t.pieces_count %></td>
    <td><%= t.last_error %></td>
    <td><%= link_to("delete", tracker_path(t), :class => "delete", :method => 'delete') %></td>
  </tr>
<% end %>
</table>

<h3>Web Hooks (<%= ( @hook_trackers || []).length %>)</h3>
<% if @hook_trackers %>
 <ul>
<% for t in @hook_trackers %>
    <li><%= link_to(t.name, t) %> - <%= t.web_hook %></li>
<% end %>
</ul>
<% else %>
  No tracker has defined a web hook.
<% end %>

<script type="text/javascript">
  // http://brandonaaron.net/blog/2009/02/25/unobtrusive-destroy-links-in-rails-using-jquery
  jQuery(document).ready(function() {
    $('a.delete').live('click', function(event) {

        if ( confirm("Delete this tracker?") )
            $.ajax({
                url: this.href.replace(/\/delete$/,''),
                type: 'post',
                dataType: 'script',
                data: { '_method': 'delete' },
                success: function() {
                  // the item has been deleted
                  // reload by setting window.location
                  window.location = '/stats'
                }
            });

        return false;
    });
  });
</script>
